(function(){var d={qiniuUploadURL:"",qiniuImageURLPrefix:"",qiniuUploadToken:"",qiniuUploadTokenURL:""};module.exports={init:e,upload:c,};function e(f){if(f.uploadURL){d.qiniuUploadURL=f.uploadURL}else{console.error("qiniu uploader need uploadURL")}if(f.uptoken){d.qiniuUploadToken=f.uptoken}else{if(f.uptokenURL){d.qiniuUploadTokenURL=f.uptokenURL}else{console.error("qiniu uploader need uptoken or uptokenURL");return}}if(f.domain){d.qiniuImageURLPrefix=f.domain}}function c(h,i,f,g){if(g){e(g)}if(!d.qiniuUploadToken){a(function(){b(h,i,f)})}else{b(h,i,f)}}function b(h,j,f){var g=d.qiniuUploadURL;var k=h.split("//")[1];var i={"token":d.qiniuUploadToken,"key":k};wx.uploadFile({url:g,filePath:h,name:"file",formData:i,success:function(m){var o=m.data;var n=JSON.parse(o);var l=d.qiniuImageURLPrefix+n.key;n.imageURL=l;console.log(n);j(n)},fail:function(l){console.log(l);f(l)}})}function a(f){wx.request({url:d.qiniuUploadTokenURL,success:function(h){var g=h.data.data.uptoken;d.qiniuUploadToken=g;if(f){f()}},fail:function(g){console.log(g)}})}})();